{{- $namespace := .Release.namespace }}
{{- range $k, $v := .Values.tls_contexts }}
{{- $common_name := $k | replace "-" "." }}
---
apiVersion: getambassador.io/v3alpha1
kind: Host
metadata:
  name: wildcard-{{- $common_name }}
  namespace: {{ $namespace }}
spec:
  requestPolicy:
    insecure:
      action: Redirect
  hostname: "*.{{- $k }}"
  tlsSecret:
    name: "ambassador-certs-{{- $v }}-{{- $common_name }}"
  tlsContext:
    name: tls-{{- $common_name }}
---
apiVersion: getambassador.io/v3alpha1
kind: Host
metadata:
  name: host-{{- $common_name }}
  namespace: {{ $namespace }}
spec:
  requestPolicy:
    insecure:
      action: Redirect
  hostname: "{{- $k }}"
  tlsSecret:
    name: "ambassador-certs-{{- $v }}-{{- $common_name }}"
  tlsContext:
    name: tls-{{- $common_name }}
{{- end }}
